{% extends "layout.html" %}

{% set title = "Edit Peripheral" if peripheral else "New Peripheral" %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
<h2><i class="fas fa-keyboard"></i> {{ title }}</h2>
<hr>

<div class="card">
    <div class="card-body">
        <form method="POST">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="name" class="form-label">Name *</label>
                    <input type="text" class="form-control" id="name" name="name" value="{{ peripheral.name if peripheral else '' }}" required>
                </div>
                <div class="col-md-6">
                    <label for="type" class="form-label">Type</label>
                    <input type="text" class="form-control" id="type" name="type" value="{{ peripheral.type if peripheral else '' }}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="brand" class="form-label">Brand</label>
                    <input type="text" class="form-control" id="brand" name="brand" value="{{ peripheral.brand if peripheral else '' }}">
                </div>
                <div class="col-md-6">
                    <label for="serial_number" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="serial_number" name="serial_number" value="{{ peripheral.serial_number if peripheral else '' }}">
                </div>
            </div>

            <div class="row mb-3">
                 <div class="col-md-6">
                    <label for="status" class="form-label">Status *</label>
                    <select class="form-select" id="status" name="status" required>
                        {% set statuses = ['In Use', 'Stored', 'Unavailable', 'Disposed'] %}
                        {% for status in statuses %}
                        <option value="{{ status }}" {% if peripheral and peripheral.status == status %}selected{% endif %}>{{ status }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <hr>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="purchase_date" class="form-label">Purchase Date</label>
                    <input type="date" class="form-control" id="purchase_date" name="purchase_date" value="{{ peripheral.purchase_date.strftime('%Y-%m-%d') if peripheral and peripheral.purchase_date else '' }}">
                </div>
                <div class="col-md-6">
                    <label for="warranty_length" class="form-label">Warranty Length (months)</label>
                    <input type="number" class="form-control" id="warranty_length" name="warranty_length" min="0" value="{{ peripheral.warranty_length if peripheral else '' }}">
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="supplier_id" class="form-label">Supplier</label>
                    <select class="form-select" id="supplier_id" name="supplier_id">
                        <option value="">Select a supplier...</option>
                        {% for supplier in suppliers %}
                        <option value="{{ supplier.id }}" {% if peripheral and peripheral.supplier_id == supplier.id %}selected{% endif %}>
                            {{ supplier.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="purchase_id" class="form-label">Purchase</label>
                    <select class="form-select" id="purchase_id" name="purchase_id">
                        <option value="">Select a purchase...</option>
                        {% for purchase in purchases %}
                        <option value="{{ purchase.id }}" {% if peripheral and peripheral.purchase_id == purchase.id %}selected{% endif %}>
                            {{ purchase.description }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <hr>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="user_id" class="form-label">Assigned To User</label>
                    <select class="form-select" id="user_id" name="user_id">
                        <option value="">Select a user...</option>
                        {% for user in users %}
                        <option value="{{ user.id }}" {% if peripheral and peripheral.user_id == user.id %}selected{% endif %}>
                            {{ user.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="asset_id" class="form-label">Attached to Asset</label>
                    <select class="form-select" id="asset_id" name="asset_id">
                        <option value="">Select an asset...</option>
                        {% for asset in assets %}
                        <option value="{{ asset.id }}" {% if peripheral and peripheral.asset_id == asset.id %}selected{% endif %}>
                            {{ asset.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <hr>
            
            <div class="mt-4">
                <a href="{{ url_for('peripherals.peripherals') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Save Peripheral</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}