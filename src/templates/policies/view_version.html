{% extends "layout.html" %}
{% block title %}Policy: {{ version.policy.title }} v{{ version.version_number }} - {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-file-alt"></i> {{ version.policy.title }}</h2>
        <h5 class="text-muted">Version {{ version.version_number }}</h5>
    </div>
    <a href="{{ url_for('policies.detail', id=version.policy.id) }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Version History
    </a>
</div>

<div class="card">
    <div class="card-body">
        <hr>
        <div class="policy-content">
            {{ version.content | markdown | safe }}
        </div>
    </div>

    {% if version.status == 'Active' %}
    <div class="card-footer text-center">
        {% set user_ack = version.acknowledgements|selectattr('user.name', 'equalto', current_user.username)|first %}
        {% if user_ack %}
            <div class="alert alert-success mb-0">
                <i class="fas fa-check-circle"></i> You acknowledged this policy on {{ user_ack.acknowledged_at.strftime('%Y-%m-%d') }}.
            </div>
        {% else %}
            <form action="{{ url_for('policies.acknowledge_version', id=version.id) }}" method="POST">
                <button type="submit" class="btn btn-primary btn-lg">I Have Read and Understood This Policy</button>
            </form>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}